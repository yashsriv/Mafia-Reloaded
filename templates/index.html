<html>
  <head>
    <title> Mafia Reloaded </title>
    <link rel="stylesheet" href="static/css/normalize.css"></link>
    <link rel="stylesheet" href="static/css/skeleton.css"></link>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <style type="text/css">
      div#initialpage{
      margin-top:20%; 
      }
      h1#title {
      text-align:center;
      margin-bottom:5%; 
      }
    </style>
  </head>
  <body class="container">
    <div id = "initialpage">
      <div class="row">
	<h1 id="title">Mafia Reloaded</h1>
      </div>
      <form>
	<div class = "row">
	  <div class="eight columns" id = "username_input">
	    <input type="text" placeholder="Enter your username" id="username_input_box" class="u-full-width" name="user" />
	  </div>
	  <div class="four columns" id="username_submit">
	    <input type="button" class="button-primary" value="Start Playing" id="username_submit_button" />
	  </div>
      </form>
    </div>
    <script type="text/javascript">
      var data = 0;
      var username;
      var game_started = 0; 
      $("#username_submit_button").click(function() {
      data = $("form").serialize();
      username  = data.split("=")[1]; 
      $.ajax({
      url:'/main/',
      data:"user="+username,
      type:"POST",
      });
      poll_username(); 
      });
      
      function poll_username() {
      if(game_started==1) return; 
        setTimeout(function() {
          $.ajax({
            url: "/main/"+username,
            type: "GET",
            success: function(data) {
              alert("List of users: " + data);
              game_started=1;
         },
         dataType: "text",
         complete: poll_username,
         timeout: 2000
        })
      },
      5000);
      }

      /* poll test */
      function poll_hello() {
      setTimeout(function() {
        $.ajax({
          url: "/poll",
          type:"GET", 
          success: function(data) {
            document.body.innerHTML+=data
            },
          dataType:"text", 
          complete:poll_hello,
          timeout:2000 
        });
      }, 5000)
      }
      poll_hello();
      
    </script>
  </body>
</html>
    
